<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
</head>
<body>

<p>See console</p>

<script>

  var glider = [[1, 0], [2, 1], [2, 2], [1, 2], [0, 2]].flat();

  console.log('glider', glider);

  // const gol = Module.cwrap("gol", "number", ["number", "number", "number"]);

  const MAX_CELLS = 10000;

  const int32perCell = 2;

  const shapePtr = Module._malloc(MAX_CELLS * Int32Array.BYTES_PER_ELEMENT * 8); // 8 neighbours
  const neighbourPtr = Module._malloc(MAX_CELLS * Int32Array.BYTES_PER_ELEMENT * 12); // 8 neighbours / 2 * 3

  const inputArray = new Int32Array(glider);

  // Copy array to allocated memory address
  Module.HEAP32.set(inputArray, shapePtr / inputArray.BYTES_PER_ELEMENT);

  // Call wasm function
  const newSize =
    gol(shapePtr, neighbourPtr, inputArray.length / int32perCell) *
    int32perCell;

  // Read memory
  const outArr = new Int32Array(Module.HEAP32.buffer, shapePtr, newSize);

  console.log('outArr', outArr);

  Module._free(inputPtr);
  Module._free(outputPtr);

</script>

</body>
</html>
